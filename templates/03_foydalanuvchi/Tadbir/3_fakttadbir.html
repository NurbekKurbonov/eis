{% extends '03_foydalanuvchi/00_base.html' %}

{% block title %} {{titleown}} {% endblock title %}

{% block content %}

<div class="mb-3 text-center">
    <h1 class="h3 d-inline align-middle"><B style="color: green">{{t_reja.resurs.nomi}}ni tejash uchun TTCHT </B></h1>    
</div>
<div class="mb-3 text-center">
    <h5 class="h3 d-inline align-middle">{{t_reja.dan|date:"d-m-Y"}}  <<<B style="color: green"> {{qoldi}} kun qoldi </B>  >> {{t_reja.gacha|date:"d-m-Y"}}</h5>
    <a href="{% url 'ftadbir' %}" class="btn btn-outline-info float-end mt-n1"><i class="fas fa-backward"></i></a>
</div>

<div class="row">
    <div class="col-12 col-xl-12">
        <div class="card linestyle">            
            <div class="card-body">
                    <div class="row">
                        <div class="mb-3 col-2 text-center borderSTYLE"  style="text-align: center;">                            
                            <label class="form-label"><B>REJA ({{t_reja.resurs.birlik}})</B></label>                                
                                <a class="form-control textSTYLE" disabled><B>{{t_reja.tejaladi}}</B></a>
                            
                        </div> 
                        <div class="mb-3 col-1">
                        </div>
                        <div class="mb-3 col-2 text-center borderSTYLE"  style="text-align: center;">                            
                            <label class="form-label"><B>REJA (mln.so'm)</B></label>                                
                                <a class="form-control textSTYLE" disabled><B>{{t_reja.tejaladi_pul}}</B></a>
                            
                        </div> 
                        <div class="mb-3 col-1">
                            <div class="d-flex flex-column w-100" style="text-align: center">
                                <span class="me-2 mb-1 text-muted">Bajarilganlik darajasi</span>
                                <span class="me-2 mb-1 text-muted"><B>{{t_reja.bajarilishi}}%</B></span>
                                <div class="progress progress-sm bg-{% if t_reja.bajarilishi in list_danger%}danger{% else %}success{% endif %}-light w-100">
                                    <div class="progress-bar bg-{% if t_reja.bajarilishi in list_danger%}danger{% else %}success{% endif %}" role="progressbar" style="width:{{t_reja.bajarilishi}}%;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 col-2 text-center borderSTYLE"  style="text-align: center;">                            
                            <label class="form-label"><B>Amalda ({{t_reja.resurs.birlik}})</B></label>                                
                                <a class="form-control textSTYLE" disabled><B>{{t_reja.tejaldi}}</B></a>
                            
                        </div> 
                        <div class="mb-3 col-1">
                        </div>
                        <div class="mb-3 col-2 text-center borderSTYLE"  style="text-align: center;">                            
                            <label class="form-label"><B>Amalda (mln.so'm)</B></label>                                
                                <a class="form-control textSTYLE" disabled><B>{{t_reja.tejaldi_pul}}</B></a>
                            
                        </div>             
                    </div>  
            </div>
        </div>
    </div> 
</div>



<div class="row">
    <div class="col-12 col-lg-12 col-xl-8">
        <div class="card">
            <div class="card-header">
                <div class="card-actions float-end">
                    <div class="dropdown position-relative">
                        <a href="#" data-bs-toggle="dropdown" data-bs-display="static">
                            <i class="align-middle" data-feather="more-horizontal"></i>
                        </a>

                        <div class="dropdown-menu dropdown-menu-end">
                            <a class="dropdown-item" href="#">1</a>
                        </div>
                    </div>
                </div>
                <h5 class="card-title">Jarayonda</h5>
                <h6 class="card-subtitle text-muted">Bajarilayotgan TTCHT</h6>
            </div>
            <div class="card-body">
                {% for i in rejalar %}
                {% if i.bajarilishi in bajarildi %}

            <form action="{% url 'faktsave' i.id t_reja.id%}" method="post">
                {% csrf_token %}
                <div id="tasks-progress" style="min-height:50px;">
                    <div class="card mb-3 bg-light cursor-grab border">
                        <div class="card-body p-3">
                            <div class="float-end me-n2">
                                <label class="form-check">
                                    <div class="d-flex flex-column w-100">
                                        <span class="me-2 mb-1 text-muted">{{i.bajarilishi}}%</span>
                                        <div class="progress progress-sm bg-{% if i.bajarilishi in list_danger%}danger{% else %}success{% endif %}-light w-100">
                                            <div class="progress-bar bg-{% if i.bajarilishi in list_danger%}danger{% else %}success{% endif %}" role="progressbar" style="width: {{i.bajarilishi}}%;"></div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                            <p>{{i.nomi}}</p>
                            <p>{{i.dan|date:"d-m-Y"}} <<  >> {{i.gacha|date:"d-m-Y"}}</p>
                            <div class="row">
                                <div class="col-xl-6">
                                    <div class="input-group mb-3">
										<span class="input-group-text">Reja: </span>
										<input type="text" class="form-control" value="{{i.tejaladi}}"  disabled>
										<span class="input-group-text">{{t_reja.resurs.birlik}}</span>
									</div>
                                </div>
                                <div class="col-xl-6">
                                    <div class="input-group mb-3">
										<span class="input-group-text">Amalda: </span>
										<input type="number" autofocus required="true" step="0.000001" name="tejaldi" class="form-control" value="{{i.tejaldi}}">
										<span class="input-group-text">{{t_reja.resurs.birlik}}</span>
									</div>
                                </div>
                                <div class="col-xl-6">
                                    <div class="input-group mb-3" >
										<span class="input-group-text">Reja: </span>
										<input type="number" autofocus required="true" step="0.000001" class="form-control" autofocus required="true" value="{{i.tejaladi_pul}}" disabled>
										<span class="input-group-text">mln.so'm</span>
									</div>
                                </div>
                                <div class="col-xl-6">
                                    <div class="input-group mb-3">
										<span class="input-group-text">Amalda: </span>
										<input type="text" step="0.000001" name="tejaldi_pul" class="form-control" value="{{i.tejaldi_pul}}">
										<span class="input-group-text">mln.so'm</span>
									</div>
                                </div>
                                <div class="col-xl-4">
                                    <div class="input-group mb-3">
										<span class="input-group-text">Bajarilish ulushi: </span>
										<input type="number" name="bajarilishi" min="0" step="0.000001" class="form-control" value="{{i.bajarilishi}}">   
                                        <span class="input-group-text">%</span>                                     
									</div>
                                </div>
                                <div class="mb-3 col-8">
                                    <label class="form-label">Izoh</label>
                                    <textarea rows="2" type="text" 
                                        class="form-control"                                
                                        autofocus required="true"
                                        placeholder = ""                              
                                        name = "nega"
                                        value = "{{i.nega}}">{{i.nega}}</textarea>
                                </div> 
                            </div>

                            <div class="float-end mt-n1">
                                <button class="btn btn-info btn-sm"><i class="fas fa-save"></i>O'zgarishni saqlash</button>
                            </div>
                            
                        </div>
                    </div>                    
                </div>
            </form>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-12 col-xl-4">
        <div class="card">
            <div class="card-header">
                <div class="card-actions float-end">
                    <div class="dropdown position-relative">
                        <a href="#" data-bs-toggle="dropdown" data-bs-display="static">
                            <i class="align-middle" data-feather="more-horizontal"></i>
                        </a>

                        <div class="dropdown-menu dropdown-menu-end">
                            <a class="dropdown-item" href="#">1</a>
                        </div>
                    </div>
                </div>
                <h5 class="card-title">Bajarildi</h5>
                <h6 class="card-subtitle text-muted">Tugatilgan TTCHT</h6>
            </div>
            <div class="card-body">
                {% for i in rejalar %}
                {% if not i.bajarilishi in bajarildi %}
                <div id="tasks-progress" style="min-height:50px;">
                    <div class="card mb-3 bg-light cursor-grab border">
                        <div class="card-body p-3">
                            <div class="float-end me-n2">
                                <label class="form-check">
                                    <div class="d-flex flex-column w-100">
                                        <span class="me-2 mb-1 text-muted">{{i.bajarilishi}}%</span>
                                        <div class="progress progress-sm bg-{% if i.bajarilishi in list_danger%}danger{% else %}success{% endif %}-light w-100">
                                            <div class="progress-bar bg-{% if i.bajarilishi in list_danger%}danger{% else %}success{% endif %}" role="progressbar" style="width: {{i.bajarilishi}}%;"></div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                            <p>{{i.nomi}}</p>
                            <p>{{i.dan|date:"d-m-Y"}} <<  >> {{i.gacha|date:"d-m-Y"}}</p>
                            <div class="float-end mt-n1">
                                <a class="btn btn-warning btn-sm" href="{% url 'faktedit' i.id t_reja.id%}"><i class="fas fa-backward"></i></a>
                            </div>
                        </div>
                    </div>                    
                </div>
                {% endif %}
                {% endfor %}
                
            </div>
        </div>
    </div>
</div>


<script>    
    const mu = document.getElementById('mu');

    const nb = document.getElementById('nb');
    const pb = document.getElementById('pb');
    
    if (mu.checked) {
        nb.style.display = 'block';
        pb.style.display = 'block';
      } else {
        nb.style.display = 'none';
        pb.style.display = 'none';
      }
    mu.addEventListener('click', function handleClick() {
      if (mu.checked) {
        nb.style.display = 'block';
        pb.style.display = 'block';
      } else {
        nb.style.display = 'none';
        pb.style.display = 'none';
      }
    });
    
</script>
{% endblock content %}
{% block scripts %}
<script>
    // Flatpickr
    flatpickr(".flatpickr-minimum");
    flatpickr(".flatpickr-datetime", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
    });
    flatpickr(".flatpickr-human", {
        altInput: true,
        altFormat: "F j, Y",
        dateFormat: "Y-m-d",
    });
    flatpickr(".flatpickr-multiple", {
        mode: "multiple",
        dateFormat: "Y-m-d"
    });
    flatpickr(".flatpickr-range", {
        mode: "range",
        dateFormat: "Y-m-d"
    });
    flatpickr(".flatpickr-time", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "H:i",
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        dragula([
            document.querySelector("#tasks-backlog"),
            document.querySelector("#tasks-progress"),
            document.querySelector("#tasks-completed")
        ]);
    });
</script>
{% endblock scripts %}