{% extends '03_foydalanuvchi/00_base.html' %}
{% load static %}

{% block title %} {{titleown}} {% endblock title %}
<!--BAR ACTIVE-->

{% block bar7 %}active{% endblock bar7 %}

{% block content %}

{% block head %}
    <style>
        .highcharts-credits{
            display: none;
        }

    </style>
{% endblock head %}
{% csrf_token %} 

<div class="mb-3">
    <h1 class="h3 d-inline align-middle">{{titleown}}</h1>
</div>

<div class="row"> 
    <div class="col-12 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Elektr energiyasining solishtirma sarfi ko'rsatkichi</h5>
            </div>
            <div class="card-body text-center">
                <div class="chart w-100">
                    <div id="apexcharts-pie" style="max-width: 440px;margin:auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Mahsulot ishlab chiqarish</h5>                
                </h6>
            </div>
            <div class="card-body">
                <div class="chart w-100">
                    <div id="apexcharts-bar"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 col-lg-12">
        <div class="row">
            <div class="col-12 col-lg-10"> 
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Elektr solishtirma sarf ko'rsatgichi</h5>               
                    </div>
                    <div class="card-body">
                        <div class="chart w-100">
                            <div id="apexcharts-column"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-2"> 
                <div class="col-sm-6 col-xl-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col mt-0">
                                    <h5 class="card-title">Eng katta solishtirma sarf</h5>
                                </div>
                                <div class="col-auto" style="color: rgb(0,100,250)">
                                    {{sana_max}}			
                                </div>
                            </div>
                            <h1 class="mt-1 mb-3" style="color: rgb(100,50,250)"><B>{{eng_katta_meyor}}</B></h1>
                            <!--<div class="mb-0">
                                <span class="badge badge-success-light"> <i class="mdi mdi-arrow-bottom-right"></i> 4.65% </span>
                                <span class="text-muted">Oldingi yilga nisbatan</span>
                            </div>-->
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-xl-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col mt-0">
                                    <h5 class="card-title">Eng kichik solishtirma sarf</h5>
                                </div>
                                <div class="col-auto" style="color: rgb(0,100,250)">
                                    {{sana_min}}			
                                </div>
                            </div>
                            <h1 class="mt-1 mb-3" style="color: rgb(100,50,250)"><B>{{eng_kichik_meyor}}</B></h1>
                            <!--<div class="mb-0">
                                <span class="badge badge-success-light"> <i class="mdi mdi-arrow-bottom-right"></i> 4.65% </span>
                                <span class="text-muted">Oldingi yilga nisbatan</span>
                            </div>-->
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-xl-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col mt-0">
                                    <h5 class="card-title">Hisobiy solishtirma sarf</h5>
                                </div>
                                <div class="col-auto" style="color: rgb(0,100,250)">
                                    			
                                </div>
                            </div>
                            <h1 class="mt-1 mb-3" style="color: rgb(100,50,250)"><B>{{hisobiy_meyor}}</B></h1>
                            <!--<div class="mb-0">
                                <span class="badge badge-success-light"> <i class="mdi mdi-arrow-bottom-right"></i> 4.65% </span>
                                <span class="text-muted">Oldingi yilga nisbatan</span>
                            </div>-->
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
</div>

<div class="row">  
    <div class="row">
        <figure class="highcharts-figure">
            <div id="container2"></div>
        </figure>
    </div>    
    <!--
    <div class="col-12">
        <div class="card">            
            <div class="card-body">         
                <table class="table table-bordered" >
                    <thead>
                        <tr>
                            <th>T/r</th>                            
                            <th>Davr</th>                            
                            <th>XUQ (ССЗ)</th>                            
                            <th>MT (СПП))</th> 
                            <th style="background-color:rgba(0,255,0,0.2); border: 2px solid green">ES(ЭЭ)</th> 
                            <th>UEE (ДЭЛ))</th> 
                            <th>UIE (ДТ))</th> 
                        </tr>
                    </thead>
                    <tbody> 
                        {% for k,v in list_vvp.items %}               
                        <tr>
                            <td>{{k}}</td>
                            <td>#</td>
                            <td>#</td>
                            <td>{{v}}</td>
                            <td style="background-color:rgba(0,255,0,0.2); border: 2px solid green"> </td>
                            <td></td>
                            <td></td>
                        </tr>
                        {% endfor %}  
                    </tbody>                     
                </table>
            </div>
        </div>
    </div>-->
</div>

<!-- *****************************offcanvas boshlandi*******************************************************************-->
<div class="offcanvas offcanvas-bottom" style="width: 20%; left: 40%; height: 80%" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
aria-labelledby="offcanvasBottomLabel" >
<div class="offcanvas-header">
    <h5 class="offcanvas-title text-center" id="offcanvasWithBothOptionsLabel" style="color: blue">Siz qaysi vaqt oralig'idagi holatni ko'rmoqchisiz?!</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
</div>
<div class="offcanvas-body">
    <form action="{% url 'addichresforhis' %}" method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-12">
                <div class="card">         
                    <form action="{% url 'addhisobot' %}" method="post">
                        {% csrf_token %}   
                    <div class="card-body">
                        
                        <h4 style="color:blue"><B>Kerakli davrni tanlang</B></h4>             
                        <div class="row"> 
                            <div class="col-12 col-xl-12">
                                <div class="mb-3">
                                    <label class="form-label">Davrni tanlang</label>
                                    <input type="text" name="oraliq" class="form-control flatpickr-range" placeholder="Davrni tanlang..." />
                                </div>                        
                            </div>
                        </div>
                    </div>                    
                    </form>
                </div>
            </div>            
            
        </div>
        <button type="submit" class="btn btn-primary float-end" id="notyf-show">Qabul qilish</button>                    
    </form>
</div>


<!-- *****************************offcanvas tugadi*******************************************************************-->
{% endblock content %}

{% block scripts %}
<script>
    // Flatpickr
    flatpickr(".flatpickr-minimum");
    flatpickr(".flatpickr-datetime", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
    });
    flatpickr(".flatpickr-human", {
        altInput: true,
        altFormat: "F j, Y",
        dateFormat: "Y-m-d",
    });
    flatpickr(".flatpickr-multiple", {
        mode: "multiple",
        dateFormat: "Y-m-d"
    });
    flatpickr(".flatpickr-range", {
        mode: "range",
        dateFormat: "Y-m-d"
    });
    flatpickr(".flatpickr-time", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "H:i",
    });
</script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="js/analyse.js"></script>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Pie chart
        var options = {
            chart: {
                height: 500,
                type: "donut",
            },
            fill: {
                type: 'gradient',
              },            
            dataLabels: {
                enabled: false
            },
            series: [{% for k,v in fakt_nisbiy_meyor.items%}{{v}},{% endfor %}],
            labels: [{% for k,v in fakt_nisbiy_meyor.items%}"{{k}} : {{v}}",{% endfor %}],      
        }
        var chart = new ApexCharts(
            document.querySelector("#apexcharts-pie"),
            options
        );
        chart.render();
        
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Column chart
        var options = {
            chart: {
                height: 350,
                type: "bar",
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    endingShape: "rounded",
                    columnWidth: "55%",
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ["transparent"]
            },
            series: [{
                name: "Nisbiy me'yor reja",
                data: [{% for k,v in plan_nisbiy_meyor.items%}{{v}},{% endfor %}]
            }, {
                name: "Nisbiy me'yor fakt",
                data: [{% for k,v in fakt_nisbiy_meyor.items%}{{v}},{% endfor %}]
            }],
            xaxis: {
                categories: [{% for k,v in fakt_nisbiy_meyor.items%}"{{k}}",{% endfor %}],
            },
            yaxis: {
                title: {
                    text: "{{birlik}}"
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function(val) {
                        return ">> " + val + "{{birlik}}"
                    }
                }
            }
        }
        var chart = new ApexCharts(
            document.querySelector("#apexcharts-column"),
            options
        );
        chart.render();
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Bar chart
        var options = {
            chart: {
                height: 350,
                type: "bar",
                stacked: true,
            },
            plotOptions: {
                bar: {
                    horizontal: true,
                },
            },
            stroke: {
                width: 1,
                colors: ["#fff"]
            },
            series: [            
            {
                name: "Ishlab chiqarilgan Mahsulot",
                data: [{% for v in mahsulot%}"{{v}}",{% endfor %}]
            }],
            
            xaxis: {
                categories: [{% for v in sana%}"{{k}}",{% endfor %}],
                labels: {
                    formatter: function(val) {
                        return val + " Tonna"
                    }
                }
            },
            yaxis: {
                title: {
                    text: undefined
                },
            },
            tooltip: {
                y: {
                    formatter: function(val) {
                        return val + "K"
                    }
                }
            },
            fill: {
                opacity: 1
            },
            legend: {
                position: "top",
                horizontalAlign: "left",
                offsetX: 40
            }
        }
        var chart = new ApexCharts(
            document.querySelector("#apexcharts-bar"),
            options
        );
        chart.render();
    });
</script>
<script>
    // Create the chart
    Highcharts.chart('container2', {
        chart: {
            type: 'column'
        },
        title: {
            text: 'Energiya sig`imliligi grafigi (oylar kesimida)'
        },
        subtitle: {
            text: ''
        },
        accessibility: {
            announceNewData: {
                enabled: true
            }
        },
        xAxis: {
            type: 'category'
        },
        yAxis: {
            title: {
                text: 'Energiya sig`imliligi'
            },
            // 3 ta Chiziq 
            plotLines: [{
                color: 'red',
                width: 6,
                value: 0.75,
                dashStyle: 'longdashdot'
            }, {
                color: 'yellow',
                width: 6,
                value: 0.5,
                dashStyle: 'longdashdot'
            }, {
                color: 'green',
                width: 6,
                value: 0.25,
                dashStyle: 'longdashdot'
            }],
            // 3 ta chiziq

        },
        legend: {
            enabled: false
        },
        plotOptions: {
            series: {
                borderWidth: 0,
                dataLabels: {
                    enabled: true,
                    format: '{point.y:.1f}'
                }
            }
        },

        tooltip: {
            headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
            pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}</b><br/>'
        },

        series: [{
            name: "Energiya sig'imliligi",
            colorByPoint: true,
            data: [
            {% for k,v in sigimlilik.items %}
            {
                name: "{{k}}",
                y: {{v}},
                drilldown: ""
            },
            {% endfor %}
        ]
        }]                
    });
</script>

{% endblock scripts %}