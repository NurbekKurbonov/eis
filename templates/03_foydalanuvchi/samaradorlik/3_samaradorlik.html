{% extends '03_foydalanuvchi/00_base.html' %}
{% load static %}

{% block title %} {{titleown}} {% endblock title %}
<!--BAR ACTIVE-->

{% block bar7 %}active{% endblock bar7 %}

{% block content %}

{% block head %}
    <style>
        .highcharts-credits{
            display: none;
        }

    </style>
{% endblock head %}
{% csrf_token %} 

<div class="mb-3" style="text-align: center;" >
    <h1 class="h3 d-inline align-middle" style="background: #00CF3E;
    background: radial-gradient(circle farthest-corner at center center, #00CF3E 0%, #0DA321 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;">{{titleown}}</h1>
</div>
<div class="row" style="text-align: center;" > 
    <div class="col-12 col-lg-12">
        <a href="{% url 'samaradorlik' 'Umumiy' %}" class="btn btn-outline-primary" style="margin-bottom: 5px; padding-top: 5px">{{korxona.about}}</i></a>
        
    {% for i in sexlar %}    
        <a href={% url 'samaradorlik' i.nomi %} class="btn btn-outline-primary" style="margin-bottom: 5px; padding-top: 5px">{{forloop.counter}}. {{i.nomi}}</i></a>    
    {% endfor %}
    </div>
</div>
<div class="mb-3">
    <h1 class="h3 d-inline align-middle" style="background: #00CF3E;
    background: radial-gradient(circle farthest-corner at center center, #00CF3E 10%, #0DA321 90%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;">{{nomi}}</h1>
</div>
<div class="row">
    <div class="col-12 col-lg-4">
        <div class="d-flex align-items-start">
            <img src="{% static 'svg/ses.png' %}" width="5%" height="5%" class="rounded-circle me-2" alt="Vanessa Tucker">
            <div class="flex-grow-1">                
                <strong>Solishtirma snergiya sarfi</strong>
            </div>
        </div>
        <div class="card">
          <div class="card-header" align="center">            
            <h6 class="card-subtitle text-muted">
              <a href="#" class="btn btn-outline-warning float-end"> <i class="align-middle me-2 fas fa-fw fa-calendar-alt"></i></a>  
            </h6>
          </div>
          <div class="card-body">
            <div class="chart w-100">
              <div id="apexcharts-line"></div>
            </div>
          </div>
        </div>
    </div>
      
    <div class="col-12 col-lg-4">
        <div class="d-flex align-items-start">
            <img src="{% static 'svg/co2-icon.svg' %}" width="5%" height="5%" class="rounded-circle me-2" alt="Vanessa Tucker">
            <div class="flex-grow-1">                
                <strong>Issiqxona gazlari</strong>
            </div>
        </div>
        <div class="card">   
            <div class="card-header" align="center">            
                <h6 class="card-subtitle text-muted">
                    <a href="#" class="btn btn-outline-warning float-end"> <i class="align-middle me-2 fas fa-fw fa-calendar-alt"></i></a>  
                </h6>
                </div>                 
            <div class="card-body">
                <div class="chart w-100">
                    <div id="apexcharts-column"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-4">
        <div class="d-flex align-items-start">
            <img src="{% static 'svg/losses.jpg' %}" width="5%" height="5%" class="rounded-circle me-2" alt="Vanessa Tucker">
            <div class="flex-grow-1">                
                <strong>Energiya isroflari</strong>
            </div>
        </div>
        <div class="card">   
            <div class="card-header">
                <div class="card-header" align="center">            
                    <h6 class="card-subtitle text-muted">
                      <a href="#" class="btn btn-outline-warning float-end"> <i class="align-middle me-2 fas fa-fw fa-calendar-alt"></i></a>  
                    </h6>
                  </div>
            </div>         
            <div class="card-body">
                <div class="chart">
                    <canvas id="chartjs-line"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-12">        
        <div class="card">   
            <div class="card-header">
                <div class="card-header" align="center">            
                    <h6 class="card-subtitle text-muted">
                      <a href="#" class="btn btn-outline-warning float-end"> <i class="align-middle me-2 fas fa-fw fa-calendar-alt"></i></a>  
                    </h6>
                  </div>
            </div>         
            <div class="card-body">
                <figure class="highcharts-figure">
                    <div id="container2"></div>
                </figure>
            </div>
        </div>
    </div>

</div>

<div class="row">  
    <div class="row">
       
    </div>    
    
</div>

<!-- *****************************offcanvas boshlandi*******************************************************************-->
<div class="offcanvas offcanvas-bottom" style="width: 20%; left: 40%; height: 80%" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
aria-labelledby="offcanvasBottomLabel" >
<div class="offcanvas-header">
    <h5 class="offcanvas-title text-center" id="offcanvasWithBothOptionsLabel" style="color: blue">Siz qaysi vaqt oralig'idagi holatni ko'rmoqchisiz?!</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
</div>
<div class="offcanvas-body">
    <form action="{% url 'addichresforhis' %}" method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-12">
                <div class="card">         
                    <form action="{% url 'addhisobot' %}" method="post">
                        {% csrf_token %}   
                    <div class="card-body">
                        
                        <h4 style="color:blue"><B>Kerakli davrni tanlang</B></h4>             
                        <div class="row"> 
                            <div class="col-12 col-xl-12">
                                <div class="mb-3">
                                    <label class="form-label">Davrni tanlang</label>
                                    <input type="text" name="oraliq" class="form-control flatpickr-range" placeholder="Davrni tanlang..." />
                                </div>                        
                            </div>
                        </div>
                    </div>                    
                    </form>
                </div>
            </div>            
            
        </div>
        <button type="submit" class="btn btn-primary float-end" id="notyf-show">Qabul qilish</button>                    
    </form>
</div>


<!-- *****************************offcanvas tugadi*******************************************************************-->
{% endblock content %}

{% block scripts %}
<script>
    // Flatpickr
    flatpickr(".flatpickr-minimum");
    flatpickr(".flatpickr-datetime", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
    });
    flatpickr(".flatpickr-human", {
        altInput: true,
        altFormat: "F j, Y",
        dateFormat: "Y-m-d",
    });
    flatpickr(".flatpickr-multiple", {
        mode: "multiple",
        dateFormat: "Y-m-d"
    });
    flatpickr(".flatpickr-range", {
        mode: "range",
        dateFormat: "Y-m-d"
    });
    flatpickr(".flatpickr-time", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "H:i",
    });
</script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="js/analyse.js"></script>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
      // Line chart
      var options = {
        chart: {
          height: 350,
          type: "line",
          zoom: {
            enabled: false
          },
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          width: [5, 7, 5],
          curve: "straight",
          dashArray: [0, 8, 5]
        },
        series: [{
            name: "Solishtirma energiya sarfi",
            data: [48, 41, 62, 42, 13, 18, 29, 37, 36, 51, 32, 35]
          },
          {
            name: "O'rnatilgan me'yor",
            data: [20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20]
          },
          {
            name: "O'rtacha qiymat",
            data: [40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40]
          }
        ],
        markers: {
          size: 0,
          style: "hollow", // full, hollow, inverted
        },
        xaxis: {
          categories: ["01.2021", "02.2021", "03.2021", "04.2021", "05.2021", "06.2021", "07.2021", "08.2021", "09.2021", "10.2021", "11.2021", "12.2021"],
        },
        tooltip: {
          y: [{
            title: {
              formatter: function(val) {
                return val + " (mins)"
              }
            }
          }, {
            title: {
              formatter: function(val) {
                return val + " per session"
              }
            }
          }, {
            title: {
              formatter: function(val) {
                return val;
              }
            }
          }]
        },
        grid: {
          borderColor: "#f1f1f1",
        }
      }
      var chart = new ApexCharts(
        document.querySelector("#apexcharts-line"),
        options
      );
      chart.render();
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      // Energiya isroflari
      new Chart(document.getElementById("chartjs-line"), {
        type: "line",
        data: {
          labels: ["01/2022", "02/2022", "03/2022"],
          datasets: [{
            label: "Isrof(kWh)",
            fill: true,
            backgroundColor: "transparent",
            borderColor: window.theme.primary,
            data: [2115, 1562, 1584]
          }, {
            label: "Norma(kWh)",
            fill: true,
            backgroundColor: "transparent",
            borderColor: "#adb5bd",
            borderDash: [4, 4],
            data: [958, 724, 629]
          }]
        },
        options: {
          maintainAspectRatio: false,
          legend: {
            display: false
          },
          tooltips: {
            intersect: false
          },
          hover: {
            intersect: true
          },
          plugins: {
            filler: {
              propagate: false
            }
          },
          scales: {
            xAxes: [{
              reverse: true,
              gridLines: {
                color: "rgba(0,0,0,0.05)"
              }
            }],
            yAxes: [{
              ticks: {
                stepSize: 500
              },
              display: true,
              borderDash: [5, 5],
              gridLines: {
                color: "rgba(0,0,0,0)",
                fontColor: "#fff"
              }
            }]
          }
        }
      });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Issiqxona gazlari
        var options = {
            chart: {
                height: 350,
                type: "bar",
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    endingShape: "rounded",
                    columnWidth: "55%",
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ["transparent"]
            },
            series: [{
                name: "Nisbiy me'yor reja",
                data: [1,2,3,4,5,{% for k,v in plan_nisbiy_meyor.items%}{{v}},{% endfor %}]
            }, {
                name: "Nisbiy me'yor fakt",
                data: [1,2,3,4,5,{% for k,v in fakt_nisbiy_meyor.items%}{{v}},{% endfor %}]
            }],
            xaxis: {
                categories: [1,2,3,4,5,{% for k,v in fakt_nisbiy_meyor.items%}"{{k}}",{% endfor %}],
            },
            yaxis: {
                title: {
                    text: "{{birlik}}"
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function(val) {
                        return ">> " + val + "{{birlik}}"
                    }
                }
            }
        }
        var chart = new ApexCharts(
            document.querySelector("#apexcharts-column"),
            options
        );
        chart.render();
    });
</script>

<script>
    // Energiya sig'imlilik
    Highcharts.chart('container2', {
        chart: {
            type: 'column'
        },
        title: {
            text: 'Energiya sig`imliligi'
        },
        subtitle: {
            text: ''
        },
        accessibility: {
            announceNewData: {
                enabled: true
            }
        },
        xAxis: {
            type: 'category'
        },
        yAxis: {
            title: {
                text: 'Energiya sig`imliligi'
            },
            // 3 ta Chiziq 
            plotLines: [{
                color: 'red',
                width: 6,
                value: 0.75,
                dashStyle: 'longdashdot'
            }, {
                color: 'yellow',
                width: 6,
                value: 0.5,
                dashStyle: 'longdashdot'
            }, {
                color: 'green',
                width: 6,
                value: 0.25,
                dashStyle: 'longdashdot'
            }],
            // 3 ta chiziq

        },
        legend: {
            enabled: false
        },
        plotOptions: {
            series: {
                borderWidth: 0,
                dataLabels: {
                    enabled: true,
                    format: '{point.y:.1f}'
                }
            }
        },

        tooltip: {
            headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
            pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}</b><br/>'
        },

        series: [{
            name: "Energiya sig'imliligi",
            colorByPoint: true,
            data: [
            
            {% for k,v in sg.items %}
            {
                name: "{{k}}",
                y: {{v}},
                drilldown: ""
            },
            {% endfor %}
        ]
        }]                
    });
</script>

{% endblock scripts %}